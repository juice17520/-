<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åƒ‘ç†ºçš„æ—…éŠè¦åŠƒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --brand-green: #82ba8d; }
        .bg-brand { background-color: var(--brand-green); }
        .text-brand { color: var(--brand-green); }
        .border-brand { border-color: var(--brand-green); }
        .timeline-path { position: absolute; left: 23px; top: 0; bottom: 0; width: 2px; background: #e2e8f0; z-index: 0; }
        .event-card { transition: all 0.2s; cursor: pointer; user-select: none; }
        .event-card:active { transform: scale(0.98); background-color: #f0f7f1; }
    </style>
</head>
<body class="bg-gray-50 text-slate-800">

    <header class="bg-brand text-white p-6 shadow-xl">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <h1 class="text-2xl font-bold tracking-wider">ğŸŒ¿ TRAVEL PLANNER</h1>
            <div class="flex gap-2 items-end">
                <div>
                    <span class="text-[10px] block opacity-80 font-bold uppercase">Start</span>
                    <input type="date" id="startDate" class="text-slate-900 p-1 rounded border-none shadow-inner text-sm outline-none">
                </div>
                <div>
                    <span class="text-[10px] block opacity-80 font-bold uppercase">End</span>
                    <input type="date" id="endDate" class="text-slate-900 p-1 rounded border-none shadow-inner text-sm outline-none">
                </div>
                <button onclick="initTrip()" class="bg-white text-brand px-4 py-1.5 rounded font-bold hover:bg-gray-100 transition shadow-md text-sm">ç”Ÿæˆå¤©æ•¸</button>
                <button onclick="localStorage.clear(); location.reload();" class="bg-red-500 text-white px-2 py-1.5 rounded text-[10px] hover:bg-red-600 transition">é‡ç½®æ•¸æ“š</button>
            </div>
        </div>
    </header>

    <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-6 p-6">
        <div id="dayTabs" class="space-y-2"></div>

        <div class="md:col-span-3">
            <div id="mainEditor" class="hidden">
                <div class="bg-white p-6 rounded-xl shadow-sm mb-6 border-t-4 border-brand">
                    <div class="flex justify-between items-center mb-4">
                        <h2 id="currentDayTitle" class="text-xl font-bold text-gray-700">è«‹é¸å–æ—¥æœŸ</h2>
                        <span class="text-[10px] text-brand bg-green-50 px-2 py-1 rounded font-bold border border-green-100 italic">é•·æŒ‰å¡ç‰‡åˆªé™¤è¡Œç¨‹</span>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-6 gap-3 bg-gray-50 p-4 rounded-lg border border-gray-100 shadow-inner">
                        <div class="md:col-span-1"><label class="text-[10px] font-bold text-gray-400">æ™‚é–“</label><input type="time" id="itemTime" class="w-full p-2 border rounded text-sm"></div>
                        <div class="md:col-span-1">
                            <label class="text-[10px] font-bold text-gray-400">é¡å‹</label>
                            <select id="itemType" class="w-full p-2 border rounded text-sm">
                                <option>æ™¯é»</option><option>ç¾é£Ÿ</option><option>äº¤é€š</option><option>é£¯åº—</option><option>è¡Œç¨‹</option><option>è¾¦ç†</option>
                            </select>
                        </div>
                        <div class="md:col-span-2"><label class="text-[10px] font-bold text-gray-400">åœ°é» (é¸å¡«)</label><input type="text" id="itemTitle" placeholder="è¦å»å“ªï¼Ÿ" class="w-full p-2 border rounded text-sm"></div>
                        <div class="md:col-span-2"><label class="text-[10px] font-bold text-gray-400">å‚™è¨»</label><div class="flex gap-2"><input type="text" id="itemNote" placeholder="é¸å¡«" class="w-full p-2 border rounded text-sm"><button onclick="addItem()" class="bg-brand text-white px-4 py-2 rounded font-bold text-sm shadow-md">æ–°å¢</button></div></div>
                    </div>
                </div>

                <div class="relative min-h-[400px] bg-white rounded-xl shadow-sm p-8">
                    <div class="timeline-path"></div>
                    <div id="dayContent" class="space-y-8 relative z-10"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
let db = JSON.parse(localStorage.getItem('TRAVEL_MASTER_DB')) || {};
let currentTripId = localStorage.getItem('CURRENT_TRIP_ID') || "";
let currentActiveDate = null;
let pressTimer;

if (Object.keys(db).length === 0) {
    db["é è¨­è¡Œç¨‹"] = { start: "", end: "", data: {} };
    currentTripId = "é è¨­è¡Œç¨‹";
}

window.onload = function() {
    updateTripSelector();
    loadTripData();
};

function save() {
    localStorage.setItem('TRAVEL_MASTER_DB', JSON.stringify(db));
    localStorage.setItem('CURRENT_TRIP_ID', currentTripId);
}

function loadTripData() {
    const trip = db[currentTripId];
    document.getElementById('startDate').value = trip.start || "";
    document.getElementById('endDate').value = trip.end || "";
    document.getElementById('dayContent').innerHTML = "";
    document.getElementById('dayTabs').innerHTML = "";
    
    if (trip.start && trip.end) {
        initTrip(true);
    } else {
        document.getElementById('mainEditor').classList.add('hidden');
    }
}

function updateTripSelector() {
    let header = document.querySelector('header .max-w-6xl');
    let selectorWrap = document.getElementById('tripSelectorWrap');
    
    if (!selectorWrap) {
        selectorWrap = document.createElement('div');
        selectorWrap.id = 'tripSelectorWrap';
        selectorWrap.className = 'w-full mt-4 flex gap-2 items-center bg-black/10 p-2 rounded-lg';
        selectorWrap.innerHTML = `
            <span class="text-[10px] font-bold uppercase opacity-70 shrink-0">ç›®å‰è¨ˆç•«:</span>
            <select id="tripSelector" onchange="switchTrip(this.value)" class="bg-white text-slate-800 text-sm p-1 rounded w-full outline-none font-bold h-8"></select>
            <button onclick="createNewTrip()" class="bg-white/20 text-white px-3 py-1 rounded text-xs font-bold whitespace-nowrap">+ æ–°è¨ˆç•«</button>
        `;
        header.appendChild(selectorWrap);
    }

    const sel = document.getElementById('tripSelector');
    sel.innerHTML = "";
    Object.keys(db).forEach(name => {
        const opt = new Option(name, name);
        opt.selected = (name === currentTripId);
        sel.add(opt);
    });
}

function createNewTrip() {
    const name = prompt("è«‹è¼¸å…¥æ–°è¨ˆç•«çš„åç¨± (ä¾‹å¦‚: 2æœˆæ—¥æœ¬è¡Œ):");
    if (!name || name.trim() === "") return;
    if (db[name]) return alert("æ­¤åç¨±å·²å­˜åœ¨");
    
    db[name] = { start: "", end: "", data: {} };
    currentTripId = name;
    save();
    updateTripSelector();
    loadTripData();
}

function switchTrip(name) {
    currentTripId = name;
    currentActiveDate = null;
    save();
    loadTripData();
}

function initTrip(isSilent = false) {
    try {
        const startStr = document.getElementById('startDate').value;
        const endStr = document.getElementById('endDate').value;
        
        if (!startStr || !endStr) {
            if (!isSilent) alert("âš ï¸ éŒ¯èª¤ï¼šè«‹å…ˆé¸æ“‡æ—¥æœŸï¼");
            return;
        }

        db[currentTripId].start = startStr;
        db[currentTripId].end = endStr;
        save();

        const start = new Date(startStr);
        const end = new Date(endStr);
        const tabs = document.getElementById('dayTabs');
        tabs.innerHTML = "<h3 class='font-bold text-gray-400 mb-4 px-2 uppercase text-[10px] tracking-widest'>Travel Days</h3>";

        let curr = new Date(start);
        let dayCount = 1;

        while (curr <= end) {
            const dateStr = curr.toISOString().split('T')[0];
            if (!db[currentTripId].data[dateStr]) db[currentTripId].data[dateStr] = [];
            
            const btn = document.createElement('button');
            btn.className = "day-btn w-full text-left p-4 rounded-lg bg-white shadow-sm hover:border-brand border-2 border-transparent transition-all mb-2";
            btn.innerHTML = `<div class='text-[10px] text-gray-400 font-bold'>DAY ${dayCount}</div><div class='font-bold text-gray-700 text-sm'>${dateStr}</div>`;
            
            (function(d, b) {
                btn.onclick = function() {
                    currentActiveDate = d;
                    document.querySelectorAll('.day-btn').forEach(x => x.classList.remove('border-brand', 'bg-green-50'));
                    b.classList.add('border-brand', 'bg-green-50');
                    document.getElementById('currentDayTitle').innerText = `ğŸ“… ${d} è¡Œç¨‹æ¸…å–®`;
                    renderItems();
                };
            })(dateStr, btn);

            tabs.appendChild(btn);
            curr.setDate(curr.getDate() + 1);
            dayCount++;
        }
        document.getElementById('mainEditor').classList.remove('hidden');
    } catch (err) {
        console.error(err);
    }
}

function addItem() {
    if (!currentActiveDate) return alert("è«‹å…ˆåœ¨å·¦é‚Šé¸ä¸€å€‹æ—¥æœŸï¼");
    const time = document.getElementById('itemTime').value;
    const title = document.getElementById('itemTitle').value;
    if (!time) return alert("è«‹å¡«å¯«æ™‚é–“ï¼");

    db[currentTripId].data[currentActiveDate].push({
        id: Date.now(),
        time: time,
        type: document.getElementById('itemType').value,
        title: title.trim(),
        note: document.getElementById('itemNote').value
    });
    
    db[currentTripId].data[currentActiveDate].sort((a, b) => a.time.localeCompare(b.time));
    save(); 
    renderItems();
    document.getElementById('itemTitle').value = "";
    document.getElementById('itemNote').value = "";
}

function handlePressStart(id) {
    pressTimer = setTimeout(() => {
        if (confirm("ğŸ“¢ ç¢ºå®šè¦åˆªé™¤é€™ç­†è¡Œç¨‹å—ï¼Ÿ")) {
            db[currentTripId].data[currentActiveDate] = db[currentTripId].data[currentActiveDate].filter(i => i.id !== id);
            save(); 
            renderItems();
        }
    }, 800);
}

function handlePressEnd() { clearTimeout(pressTimer); }

function renderItems() {
    const container = document.getElementById('dayContent');
    container.innerHTML = "";
    const items = db[currentTripId].data[currentActiveDate] || [];
    if (items.length === 0) {
        container.innerHTML = `<p class="text-center text-slate-300 py-20 text-sm italic tracking-widest">é»æ“Šä¸Šæ–¹ã€Œæ–°å¢ã€è¦åŠƒé€™å¤©çš„è¡Œç¨‹</p>`;
        return;
    }
    items.forEach(item => {
        const div = document.createElement('div');
        div.className = "flex gap-6 relative items-start";
        
        const hasTitle = item.title && item.title.trim() !== "";
        const mapLink = hasTitle ? `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.title)}" target="_blank" class="text-blue-400 text-[10px] font-bold">ğŸ—ºï¸ å°èˆª</a>` : "";
        const displayTitle = hasTitle ? item.title : `[${item.type}]`;
        const titleClass = hasTitle ? "text-gray-800" : "text-gray-400 italic";

        div.innerHTML = `
            <div class="w-12 pt-1 text-sm font-black text-brand">${item.time}</div>
            <div class="w-4 h-4 rounded-full bg-brand border-4 border-white shadow-sm mt-1.5 z-10"></div>
            <div class="flex-1 bg-white border border-gray-100 p-4 rounded-lg shadow-sm -mt-2 event-card"
                 onmousedown="handlePressStart(${item.id})" onmouseup="handlePressEnd()" ontouchstart="handlePressStart(${item.id})" ontouchend="handlePressEnd()">
                <div class="flex justify-between items-center mb-1">
                    <span class="text-[9px] font-black px-2 py-0.5 rounded bg-brand text-white uppercase tracking-tighter">${item.type}</span>
                    ${mapLink}
                </div>
                <h4 class="font-bold text-base ${titleClass}">${displayTitle}</h4>
                <p class="text-xs text-gray-400 mt-1">${item.note || ''}</p>
            </div>`;
        container.appendChild(div);
    });
}
    </script>
</body>
</html>
